{% extends "base.html" %}

{% block title %}Find Parking - ParkWise{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-md-row align-items-md-end justify-content-between gap-3 mb-4">
    <div>
        <h1 class="page-title mb-1">Find Your Parking</h1>
        <p class="text-secondary mb-0">Top recommendations first, then zone-wise browsing.</p>
    </div>
    <a href="/slots" class="btn btn-outline-primary">View All Slots</a>
</div>

{% if top_recommendations %}
<section class="mb-5">
    <h2 class="h5 fw-semibold mb-3">Top Recommendations</h2>
    <div class="row g-4">
        {% for slot in top_recommendations %}
        {% set heat = 'heat-high' if slot.score >= 130 else 'heat-mid' if slot.score >= 90 else 'heat-low' %}
        <div class="col-md-6 col-xl-4">
            <div class="card h-100 slot-card {{ heat }} {% if slot.is_occupied %}slot-occupied{% endif %}">
                <div class="card-body d-flex flex-column gap-3">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h3 class="h4 mb-1">{{ slot.slot_number }}</h3>
                            <span class="badge text-bg-light border">Zone {{ slot.zone }}</span>
                        </div>
                        {% if not slot.is_occupied %}
                        <span class="badge status-pill status-available">Available</span>
                        {% else %}
                        <span class="badge status-pill status-occupied">Occupied</span>
                        {% endif %}
                    </div>

                    <div class="score-meter" title="Score {{ slot.score }}/150">
                        <div class="score-fill {{ heat }}" style="width: {{ [((slot.score / 150) * 100) | int, 100] | min }}%;"></div>
                    </div>

                    <div class="d-flex justify-content-between text-secondary small">
                        <span>Per hour</span>
                        <strong class="text-primary">₹{{ slot.price_per_hour }}</strong>
                    </div>

                    <div class="mt-auto d-grid gap-2">
                        {% if not slot.is_occupied %}
                        <a href="/booking/{{ slot.id }}" class="btn btn-primary">Book Now</a>
                        {% else %}
                        <button class="btn btn-secondary" disabled>Not Available</button>
                        {% endif %}
                        <a href="https://maps.app.goo.gl/JMkKwNDx2sVpmPBGA" target="_blank" class="btn btn-outline-secondary">Open in Maps</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<section>
    <h2 class="h5 fw-semibold mb-3">Browse by Zone</h2>

    {% for zone in zones %}
    <div class="card border-0 shadow-sm mb-3">
        <div class="card-header bg-white border-0 pb-0">
            <h3 class="h6 mb-0 fw-semibold">Zone {{ zone }}</h3>
        </div>
        <div class="card-body pt-2">
            <div class="vstack gap-2">
                {% for slot in all_available %}
                    {% if slot.zone == zone %}
                    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 slot-list-row">
                        <div>
                            <p class="fw-semibold mb-0">{{ slot.slot_number }}</p>
                            <p class="small text-secondary mb-0">₹{{ slot.price_per_hour }}/hr</p>
                        </div>
                        <div class="d-flex gap-2">
                            <a href="/booking/{{ slot.id }}" class="btn btn-sm btn-primary">Book</a>
                            <a href="https://maps.app.goo.gl/JMkKwNDx2sVpmPBGA" target="_blank" class="btn btn-sm btn-outline-secondary">Maps</a>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    {% endfor %}

    {% if not all_available %}
    <div class="empty-state">
        <p class="mb-0">No available slots right now. Please check again shortly.</p>
    </div>
    {% endif %}
</section>
{% endblock %}
