{% extends "base.html" %}

{% block title %}Book Parking - ParkWise{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1 class="page-title">Book Your Parking</h1>
        <p class="page-subtitle">Complete your reservation</p>
    </div>

    {% if slot and not slot.is_occupied %}
    <div class="booking-wrapper">
        <div class="slot-summary">
            <div class="summary-content">
                <div class="summary-slot">
                    <span class="summary-number">{{ slot.slot_number }}</span>
                    <span class="summary-zone">{{ slot.zone }}</span>
                </div>
                <div class="summary-details">
                    <h3>Slot {{ slot.slot_number }}</h3>
                    <p>Rate: <strong>₹{{ slot.price_per_hour }}/hr</strong></p>
                </div>
            </div>
        </div>

        <form method="POST" action="/booking/{{ slot.id }}" class="booking-form">
            <div class="form-group">
                <label>Full Name *</label>
                <input type="text" name="user_name" placeholder="Your name" required>
            </div>

            <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" name="phone_number" placeholder="+91 98765 43210">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Vehicle Type</label>
                    <select name="vehicle_type">
                        {% for vt in slot.vehicle_types.split(',') %}
                        <option value="{{ vt.strip() }}">{{ vt.strip() }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label>Vehicle Number</label>
                    <input type="text" name="vehicle_number" placeholder="MH 12 AB 1234">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Start Time *</label>
                    <input type="datetime-local" name="start_time" value="{{ now_str }}" required>
                </div>

                <div class="form-group">
                    <label>End Time</label>
                    <input type="datetime-local" name="end_time" id="end_time">
                </div>
            </div>

            <div class="price-calculator" id="priceCalc">
                <p class="calc-text">Select end time to see estimated cost</p>
                <p class="calc-price" id="estimatedPrice">—</p>
            </div>

            <button type="submit" class="btn btn-primary btn-large">Confirm Booking</button>
            <a href="/slots" class="btn btn-secondary btn-large">Cancel</a>
        </form>
    </div>
    {% else %}
    <div class="empty-state">
        <h2>Slot Not Available</h2>
        <p>This slot is not available for booking. Please choose another one.</p>
        <a href="/slots" class="btn btn-primary">Browse Slots</a>
    </div>
    {% endif %}
</div>

<script>
const ratePerHour = {{ slot.price_per_hour if slot else 0 }};
document.getElementById('end_time')?.addEventListener('change', function() {
    const start = document.querySelector('[name="start_time"]').value;
    const end = this.value;
    if (start && end) {
        const startDate = new Date(start);
        const endDate = new Date(end);
        const hours = (endDate - startDate) / (1000 * 60 * 60);
        const cost = (hours * ratePerHour).toFixed(2);
        document.getElementById('estimatedPrice').textContent = '₹' + cost;
    }
});
</script>
{% endblock %}
