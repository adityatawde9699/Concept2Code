{% extends "base.html" %}

{% block title %}Book Parking - ParkWise{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-xl-8">
        <div class="mb-4">
            <h1 class="page-title mb-1">Book Your Parking</h1>
            <p class="text-secondary mb-0">Complete your reservation details.</p>
        </div>

        {% if slot and not slot.is_occupied %}
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
                <div>
                    <p class="mb-1 text-secondary small">Selected Slot</p>
                    <h2 class="h4 mb-1">{{ slot.slot_number }} <span class="badge text-bg-light border">Zone {{ slot.zone }}</span></h2>
                    <p class="mb-0 text-secondary">Rate: <strong class="text-primary">₹{{ slot.price_per_hour }}/hr</strong></p>
                </div>
                <a href="https://maps.app.goo.gl/JMkKwNDx2sVpmPBGA" target="_blank" class="btn btn-outline-secondary">Open in Maps</a>
            </div>
        </div>

        <form method="POST" action="/booking/{{ slot.id }}" class="card border-0 shadow-sm">
            <div class="card-body p-4">
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label">Full Name *</label>
                        <input type="text" name="user_name" class="form-control" placeholder="Your name" required>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" name="phone_number" class="form-control" placeholder="+91 98765 43210">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Vehicle Type</label>
                        <select name="vehicle_type" class="form-select">
                            {% for vt in slot.vehicle_types.split(',') %}
                            <option value="{{ vt.strip() }}">{{ vt.strip() }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Vehicle Number</label>
                        <input type="text" name="vehicle_number" class="form-control" placeholder="MH 12 AB 1234">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Start Time *</label>
                        <input type="datetime-local" name="start_time" class="form-control" value="{{ now_str }}" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">End Time</label>
                        <input type="datetime-local" name="end_time" id="end_time" class="form-control" data-rate="{{ slot.price_per_hour }}">
                    </div>
                </div>

                <div class="price-box mt-4" id="priceCalc">
                    <p class="small text-secondary mb-1">Estimated Cost</p>
                    <p class="h3 mb-0 text-primary" id="estimatedPrice">—</p>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-primary">Confirm Booking</button>
                    <a href="/slots" class="btn btn-outline-secondary">Cancel</a>
                </div>
            </div>
        </form>
        {% else %}
        <div class="empty-state">
            <h2 class="h5">Slot Not Available</h2>
            <p class="mb-3">This slot is currently unavailable. Please choose another one.</p>
            <a href="/slots" class="btn btn-primary">Browse Slots</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
