{% extends "base.html" %}
{% block title %}Parking History — ParkWise{% endblock %}

{% block content %}
<div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:1.5rem;" class="fade-in-up">
    <div>
        <h1 class="section-title">Parking History</h1>
        <p class="section-subtitle">All your past and active parking sessions.</p>
    </div>
    <a href="/" class="btn btn-outline btn-sm"><i class="fa-solid fa-arrow-left"></i> Dashboard</a>
</div>

{% if bookings %}
<div class="table-wrapper fade-in-up">
    <table>
        <thead>
            <tr>
                <th>Ref</th>
                <th>Slot</th>
                <th>Name</th>
                <th>Vehicle</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Duration</th>
                <th>Cost</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for booking in bookings %}
            <tr>
                <td style="color:var(--primary-light); font-size:0.8rem; font-weight:600;">
                    #PWB-{{ "%05d" | format(booking.id) }}
                </td>
                <td>
                    <div style="font-weight:700; color:var(--text-strong);">{{ booking.slot.slot_number }}</div>
                    <div style="font-size:0.78rem; color:var(--text-muted);">Zone {{ booking.slot.zone }}</div>
                </td>
                <td>
                    <div style="font-weight:600;">{{ booking.user_name }}</div>
                    {% if booking.phone_number %}
                    <div style="font-size:0.78rem; color:var(--text-muted);">{{ booking.phone_number }}</div>
                    {% endif %}
                </td>
                <td>
                    {% if booking.vehicle_type %}
                    <div>{{ booking.vehicle_type }}</div>
                    {% if booking.vehicle_number %}
                    <div style="font-size:0.78rem; color:var(--text-muted);">{{ booking.vehicle_number }}</div>
                    {% endif %}
                    {% else %}
                    <span style="color:var(--text-muted);">—</span>
                    {% endif %}
                </td>
                <td style="font-size:0.85rem;">{{ booking.start_time.strftime('%d %b %Y') }}<br>
                    <span style="color:var(--text-muted);">{{ booking.start_time.strftime('%H:%M') }}</span>
                </td>
                <td style="font-size:0.85rem;">
                    {% if booking.end_time %}
                        {{ booking.end_time.strftime('%d %b %Y') }}<br>
                        <span style="color:var(--text-muted);">{{ booking.end_time.strftime('%H:%M') }}</span>
                    {% else %}
                        <span style="color:var(--text-muted);">—</span>
                    {% endif %}
                </td>
                <td>
                    {% if booking.end_time %}
                        {% set mins = ((booking.end_time - booking.start_time).total_seconds() / 60) | int %}
                        {% if mins >= 60 %}
                            {{ (mins // 60) }}h {{ mins % 60 }}m
                        {% else %}
                            {{ mins }} min
                        {% endif %}
                    {% else %}
                        <span style="color:var(--text-muted);">Ongoing</span>
                    {% endif %}
                </td>
                <td>
                    {% if booking.total_cost %}
                        <span style="color:#34d399; font-weight:700;">₹{{ "%.2f" | format(booking.total_cost) }}</span>
                    {% else %}
                        <span style="color:var(--text-muted);">—</span>
                    {% endif %}
                </td>
                <td>
                    <span class="status-badge {% if booking.status == 'active' %}ongoing{% else %}completed{% endif %}">
                        {% if booking.status == 'active' %}
                            <i class="fa-solid fa-circle" style="font-size:0.45rem;"></i> Active
                        {% else %}
                            <i class="fa-solid fa-check"></i> Done
                        {% endif %}
                    </span>
                </td>
                <td>
                    {% if booking.status == 'active' %}
                    <button onclick="endBooking({{ booking.id }})" class="btn btn-danger-soft btn-sm">
                        <i class="fa-solid fa-circle-stop"></i> Check Out
                    </button>
                    {% else %}
                    <a href="/booking/confirm/{{ booking.id }}" class="btn btn-outline btn-sm">
                        <i class="fa-solid fa-receipt"></i>
                    </a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="glass-card fade-in-up" style="text-align:center; padding:4rem;">
    <i class="fa-solid fa-clock-rotate-left" style="font-size:3rem; color:var(--primary-light); display:block; margin-bottom:1rem;"></i>
    <p style="color:var(--text-muted); font-size:1rem;">No bookings yet.</p>
    <a href="/slots" class="btn btn-primary" style="margin-top:1rem;">
        <i class="fa-solid fa-th-large"></i> Book a Slot Now
    </a>
</div>
{% endif %}
{% endblock %}
