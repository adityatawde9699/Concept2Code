{% extends "base.html" %}

{% block title %}Booking History - ParkWise{% endblock %}

{% block content %}
<div class="mb-4">
    <h1 class="page-title mb-1">Your Bookings</h1>
    <p class="text-secondary mb-0">Track active and completed parking sessions.</p>
</div>

{% if bookings %}
<div class="vstack gap-3">
    {% for booking in bookings %}
    <div class="card border-0 shadow-sm booking-card">
        <div class="card-body p-4">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-3">
                <div>
                    <h2 class="h5 mb-1">{{ booking.slot.slot_number }} <span class="badge text-bg-light border">Zone {{ booking.slot.zone }}</span></h2>
                    <p class="mb-0 small text-secondary">{{ booking.user_name }}{% if booking.phone_number %} • {{ booking.phone_number }}{% endif %}</p>
                </div>
                {% if booking.status == 'active' %}
                <span class="badge status-pill status-active">Active</span>
                {% else %}
                <span class="badge status-pill status-completed">Completed</span>
                {% endif %}
            </div>

            <div class="history-grid small">
                {% if booking.vehicle_type %}
                <div>
                    <span class="text-secondary">Vehicle</span>
                    <p class="mb-0 fw-semibold">{{ booking.vehicle_type }}{% if booking.vehicle_number %} • {{ booking.vehicle_number }}{% endif %}</p>
                </div>
                {% endif %}
                <div>
                    <span class="text-secondary">Started</span>
                    <p class="mb-0 fw-semibold">{{ booking.start_time.strftime('%d %b %Y, %H:%M') }}</p>
                </div>
                {% if booking.end_time %}
                <div>
                    <span class="text-secondary">Ended</span>
                    <p class="mb-0 fw-semibold">{{ booking.end_time.strftime('%d %b %Y, %H:%M') }}</p>
                </div>
                <div>
                    <span class="text-secondary">Duration</span>
                    <p class="mb-0 fw-semibold">
                        {% set mins = ((booking.end_time - booking.start_time).total_seconds() / 60) | int %}
                        {% if mins >= 60 %}
                            {{ (mins // 60) }}h {{ mins % 60 }}m
                        {% else %}
                            {{ mins }} min
                        {% endif %}
                    </p>
                </div>
                {% endif %}
                {% if booking.total_cost %}
                <div>
                    <span class="text-secondary">Cost</span>
                    <p class="mb-0 fw-bold text-success">₹{{ "%.2f" | format(booking.total_cost) }}</p>
                </div>
                {% endif %}
            </div>

            {% if booking.status == 'active' %}
            <div class="mt-3 d-flex justify-content-end">
                <button type="button" class="btn btn-outline-danger btn-sm" onclick="endBooking({{ booking.id }})">Check Out</button>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <h2 class="h5">No Bookings Yet</h2>
    <p class="mb-3">You haven't made any parking reservations.</p>
    <a href="/find-parking" class="btn btn-primary">Find Parking Now</a>
</div>
{% endif %}
{% endblock %}
